{% extends 'base.html.twig' %}

{% block title %}Events index{% endblock %}

{% block content %}
    <div id="pricing" class="pricing">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="title">
                        <h2>Our<strong class="black"> Events</strong></h2>
                    </div>
                </div>
            </div>
            <div class="row">
                {% for event in events %}
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                        <div class="pricing_box">
                            <img src="{{ asset(event.image) }}" width="200" height="250" />
                            <h3>{{ event.eName }}</h3>
                            <p>Start : {{ event.eDate ? event.eDate|date('Y-m-d') : '' }}</p>
                            <p>At {{ event.place }}</p>
                            <p>{{ event.ticketPrice }} $</p>
                            <div>
                                <a class="btn-get-started" href="#" onclick="confirmParticipation({{ event.idEvent }})">Participer</a>
                            </div>
                           
                            <a class="details-link" href="{{ path('app_workshop_index_front', {'idEvent': event.idEvent}) }}"><i class="bi bi-link-45deg"></i>Workshops</a>
                              <div id="qr-code-{{ event.idEvent }}" class="event-qr-code"></div>
                        </div>
                    </div>
                {% else %}
                    <p>No records found</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        function confirmParticipation(eventId) {
            if (confirm("Are you sure you want to participate?")) {
                var participationUrl = "{{ path('app_event_participation', {'idEvent': 'eventId'}) }}".replace('eventId', eventId);
                window.location.href = participationUrl;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% for event in events %}
        var qrCode = qrcode(0, 'M');
        qrCode.addData(JSON.stringify({
            name: '{{ event.eName }}',
            startDate: '{{ event.eDate ? event.eDate|date('Y-m-d') : 'Not specified' }}',
            Place: '{{ event.place}}',
            points: '{{ event.ticketPrice }} $'
        }));
        qrCode.make();
        document.getElementById('qr-code-{{ event.idEvent }}').innerHTML = qrCode.createImgTag();
    {% endfor %}
});
</script>
{% endblock %}
